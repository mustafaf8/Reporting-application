<!doctype html>
<html lang="tr">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Teklif - <%= customerName %>
	</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<style>
		@page {
			size: A4;
			margin: 16mm 14mm 20mm 14mm;
		}

		:root {
			--emerald-900: #064e3b;
			--emerald-800: #065f46;
			--emerald-700: #047857;
			--emerald-600: #059669;
			--emerald-100: #d1fae5;
			--gray-900: #0f172a;
			--gray-700: #334155;
			--gray-600: #475569;
			--gray-500: #64748b;
			--gray-200: #e5e7eb;
			--card: #f8fafc;
		}

		body {
			font-family: 'Inter', Arial, Helvetica, sans-serif;
			color: var(--gray-900);
		}

		.container {
			max-width: 900px;
			margin: 0 auto;
		}

		.mustafa {
			padding-bottom:6px;
		}
		.mustafaa {
			font-size:12px;
		}
		.mustafaaa {
			padding-bottom: 20px;
		}

		.accent-bar {
			height: 4px;
			width: 100%;
			background: linear-gradient(90deg, var(--emerald-700), var(--emerald-600));
			border-radius: 5px;
			margin-bottom: 8px;
		}

		.report-title {
			text-align: center;
			margin: 6px 0 8px 0;
		}

		.report-title__main {
			margin: 0;
			font-size: 16px;
			font-weight: 600;
			letter-spacing: 0.2px;
			color: var(--emerald-800);
		}

		.report-title__sub {
			margin: 2px 0 0 0;
			font-size: 12px;
			color: var(--gray-600);
		}

		.header {
			display: flex;
			align-items: center;
			gap: 16px;
			padding: 8px 0 14px 0;
			border-bottom: 1px solid var(--gray-200);
		}

		.logo-wrap {
			display: flex;
			align-items: center;
			gap: 12px;
			min-height: 56px;
		}

		.logo {
			height: 56px;
			object-fit: contain;
		}

		.header-right {
			margin-left: auto;
			text-align: left;
		}

		.header-right .issuer-line {
			font-size: 12px;
			color: var(--gray-700);
		}

		.header-right .issuer-line strong {
			color: var(--gray-500);
		}

		.title {
			margin: 0;
			font-size: 26px;
			font-weight: 700;
			letter-spacing: 0.2px;
			color: var(--emerald-800);
		}

		.subtitle {
			margin: 2px 0 0 0;
			font-size: 12px;
			color: var(--gray-600);
		}

		.meta {
			color: var(--gray-700);
			margin: 2px 0;
			font-size: 12px;
		}
		
		.section {
			margin-top: 14px;
		}

		.card {
			background: var(--card);
			border: 1px solid var(--gray-200);
			border-radius: 8px;
			padding: 12px;
		}

		.card h3 {
			margin: 0 0 8px 0;
			font-size: 13px;
			font-weight: 600;
			color: var(--emerald-700);
		}

		/* Daha kompakt müşteri bilgi şeridi */
		.info-compact {
			display: flex;
			flex-wrap: wrap;
			gap: 8px 12px;
		}

		.info-chip {
			display: inline-flex;
			align-items: center;
			gap: 6px;
			background: #ecfdf5;
			border: 1px solid var(--emerald-100);
			color: var(--emerald-900);
			border-radius: 8px;
			padding: 6px 10px;
			font-size: 12px;
		}

		.info-chip .label {
			color: var(--gray-600);
			font-weight: 500;
		}

		.info-chip .value {
			color: var(--gray-800);
			font-weight: 500;
		}

		table {
			width: 100%;
			border-collapse: separate;
			border-spacing: 0;
		}

		thead th {
			background: var(--emerald-800);
			color: #ffffff;
			text-align: left;
			padding: 10px;
			font-size: 12px;
			font-weight: 600;
			border-right: 1px solid rgba(255, 255, 255, 0.12);
		}

		thead th:first-child {
			border-top-left-radius: 8px;
		}

		thead th:last-child {
			border-top-right-radius: 8px;
			border-right: none;
		}

		tbody td {
			font-size: 12px;
			padding: 10px;
			border-bottom: 1px solid var(--gray-200);
		}

		tbody tr:nth-child(odd) {
			background: #ffffff;
		}

		tbody tr:nth-child(even) {
			background: #f9fafb;
		}

		.cell-right {
			text-align: right;
		}

		.totals {
			width: 100%;
			margin-top: 10px;
		}

		.totals td {
			padding: 8px 10px;
			font-size: 12px;
		}

		.totals .label {
			text-align: right;
			color: var(--gray-600);
		}

		.totals .value {
			text-align: right;
			font-weight: 700;
		}
		
		.grand {
			background: var(--emerald-100);
			color: var(--emerald-900);
			border-top: 2px solid var(--emerald-700);
		}

		.footer {
			margin-top: 16px;
			font-size: 11px;
			color: var(--gray-500);
			border-top: 1px solid var(--gray-200);
			padding-top: 8px;
		}
		.footer-note{ line-height:1.5; letter-spacing:0.2px; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility; }
		.company-card{ margin-top:8px; border:1px solid var(--gray-200); border-radius:8px; padding:10px; background:#f0fdf4; }
		.company-name{ font-size:13px; font-weight:700; color:var(--emerald-800); margin:0 0 2px 0; }
		.company-line{ font-size:11px; color:var(--gray-700); margin:0; }
		.page-break{ page-break-before: always; }
		.about-hero{ position:relative; width:100%; height:210px; border-radius:12px; overflow:hidden; border:1px solid var(--gray-200); background:#f1f5f9; }
		.about-hero img{ width:100%; height:100%; object-fit:cover; display:block; }
		.about-hero .overlay{ position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.55)); }
		.about-hero .text{ position:absolute; left:16px; bottom:14px; right:16px; color:#fff; }
		.about-hero .text h2{ margin:0; font-size:22px; font-weight:700; letter-spacing:0.2px; }
		.about-hero .text p{ margin:4px 0 0 0; font-size:12px; opacity:0.95; }
		.about-section{ display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:12px; align-items:start; }
		.about-text{ font-size:12px; color:var(--gray-700); line-height:1.7; padding-bottom:5px;}
		.about-card{ background:#ffffff; border:1px solid var(--gray-200); border-radius:12px; padding:12px; }
		.about-card h4{ margin:0 0 8px 0; font-size:13px; color:var(--emerald-800); letter-spacing:0.2px; }
		.about-summary{ background:#ffffff; border:1px solid var(--gray-200); border-radius:12px; padding:12px; }
		.about-summary h4{ margin:0 0 8px 0; font-size:13px; color:var(--emerald-800); letter-spacing:0.2px; }
		.about-list{ list-style:none; margin:0; padding:0; display:grid; grid-template-columns:1fr; gap:8px; }
		.about-list--grid{ grid-template-columns:1fr 1fr; gap:10px; }
		.about-list li{ background:#f8fafc; border:1px solid var(--gray-200); border-left:3px solid var(--emerald-600); border-radius:10px; padding:10px; }
		.about-list li strong{ display:block; margin:0 0 4px 0; font-size:12px; color:var(--emerald-800); }
		.about-stats{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px; }
		.stat{ background:#ffffff; border:1px solid var(--gray-200); color:var(--emerald-900); border-radius:12px; padding:12px; text-align:center; }
		.stat .num{ font-size:18px; font-weight:800; letter-spacing:0.3px; color:var(--emerald-800); }
		.stat .lbl{ font-size:11px; color:var(--gray-700); margin-top:2px; }
		.about-secondary{ margin-top:12px; }
		.about-secondary .gallery{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
		.about-secondary .tile{ position:relative; border-radius:12px; overflow:hidden; border:1px solid var(--gray-200); background:#f1f5f9; height:140px; }
		.about-secondary .tile img{ width:100%; height:100%; object-fit:cover; display:block; }
		.about-secondary .section-title{ margin:6px 0 10px 0; font-size:13px; font-weight:700; color:var(--emerald-800); text-align:center; letter-spacing:0.2px; }
		/* Şirket bilgileri chip stili */
		.company-info{ display:flex; flex-wrap:wrap; gap:8px 10px; }
		.company-chip{ display:inline-flex; align-items:center; gap:6px; background:#f8fafc; border:1px solid var(--gray-200); border-radius:10px; padding:8px 10px; font-size:11px; }
		.company-chip .label{ color:var(--gray-600); font-weight:500; }
		.company-chip .value{ color:var(--gray-900); font-weight:600; }
	</style>
</head>

<body>
	<div class="container">

		<div class="report-title">
			<h1 class="report-title__main">Fiyat Teklif Raporu</h1>

		</div>
		<div class="accent-bar"></div>
		<% const c=(typeof customer !=='undefined' && customer) ? customer : null; %>
			<div class="header">
				<div class="logo-wrap">
					<% if (company && (company.logoDataUrl || company.logoUrl)) { %>
						<img class="logo" src="<%= company.logoDataUrl || company.logoUrl %>" alt="logo" />
						<% } %>
				</div>
				<div class="header-right">
					<div class="issuer-line mustafa"><span class="mustafaa">Teklif veren:</span>
						<%= (typeof issuer !=='undefined' && issuer && issuer.name) ? issuer.name : '-' %>
					</div>
					<div class="issuer-line mustafa"><span class="mustafaa">Telefon:</span>
						<%= (typeof issuer !=='undefined' && issuer && issuer.phone) ? issuer.phone : '-' %>
					</div>
					<div class="issuer-line mustafa"><span class="mustafaa">Tarih:</span>
						<%= new Date(createdAt).toLocaleDateString('tr-TR') %>
					</div>
					<% if (status) { %>
						<div class="meta"><strong>Durum:</strong>
							<%= status %>
						</div>
						<% } %>
				</div>
			</div>

			<div class="section card">
				<h3>Müşteri Bilgileri</h3>
				<div class="info-compact">
					<% const fullName=(c && (c.fullName || ((c.firstName||'') + ' ' + (c.lastName||''))).trim()) ||
						customerName || '' ; const companyName=c && c.companyName ? c.companyName : '' ; const phone=c
						&& c.phone ? c.phone : '' ; const address=c && c.address ? c.address : '' ; const email=c &&
						c.email ? c.email : '' ; %>
						<div class="info-chip"><span class="label">Ad Soyad:</span><span class="value">
								<%= fullName %>
							</span></div>
						<% if (companyName) { %>
							<div class="info-chip"><span class="label">Şirket:</span><span class="value">
									<%= companyName %>
								</span></div>
							<% } %>
								<% if (phone) { %>
									<div class="info-chip"><span class="label">Telefon:</span><span class="value">
											<%= phone %>
										</span></div>
									<% } %>
										<% if (address) { %>
											<div class="info-chip"><span class="label">Adres:</span><span class="value">
													<%= address %>
												</span></div>
											<% } %>
												<% if (email) { %>
													<div class="info-chip"><span class="label">E-posta:</span><span
															class="value">
															<%= email %>
														</span></div>
													<% } %>
				</div>
			</div>

			<div class="section">
				<table>
					<thead>
						<tr>
							<th>#</th>
							<th>Malzeme Adı</th>
							<th class="cell-right">Miktar</th>
							<th class="cell-right">Birim Fiyat</th>
							<th class="cell-right">Tutar</th>
						</tr>
					</thead>
					<tbody>
						<% items.forEach(function(item, index){ %>
							<tr>
								<td>
									<%= index + 1 %>
								</td>
								<td>
									<%= item.name %>
								</td>
								<td class="cell-right">
									<%= item.quantity %>
								</td>
								<td class="cell-right">
									<%= formatCurrency(item.unitPrice) %>
								</td>
								<td class="cell-right">
									<%= formatCurrency(item.quantity * item.unitPrice) %>
								</td>
							</tr>
							<% }); %>
					</tbody>
				</table>
			</div>

			<table class="totals section card" style="border-collapse:separate; border-spacing:0;">
				<tbody>
					<tr>
						<td class="label" style="width:70%">Ara Toplam</td>
						<td class="value">
							<%= formatCurrency(subtotal) %>
						</td>
					</tr>
					<% if (discountRate && discountRate> 0) { %>
						<tr>
							<td class="label">İskonto (<%= discountRate %>%)</td>
							<td class="value">-<%= formatCurrency(subtotal * (discountRate/100)) %>
							</td>
						</tr>
						<% } %>
							<% if (extraCosts && extraCosts> 0) { %>
								<tr>
									<td class="label">Ek Maliyetler</td>
									<td class="value">
										<%= formatCurrency(extraCosts) %>
									</td>
								</tr>
								<% } %>
									<% if (vatRate && vatRate> 0) { %>
										<tr>
											<td class="label">KDV (<%= vatRate %>%)</td>
											<td class="value">
												<%= formatCurrency(vatAmount) %>
											</td>
										</tr>
										<% } %>
											<tr class="grand" style="font-size:14px;">
												<td class="label" style="font-weight:700; color:var(--emerald-900)">
													GENEL TOPLAM</td>
												<td class="value" style="font-size:16px; color:var(--emerald-900)">
													<%= formatCurrency(grandTotal) %>
												</td>
											</tr>
				</tbody>
			</table>

			<div class="footer">
				<p class="footer-note">Not: Bu teklif bilgilendirme amaçlıdır. Yukarıdaki fiyatlandırmanın, ürünlerin
					tahmini birim fiyatları baz alınarak hesaplandığını lütfen göz önünde bulundurunuz. Bu teklifin
					geçerlilik tarihi: <strong>
						<%= new Date(createdAt + (10*24*60*60*1000)).toLocaleDateString('tr-TR') %>
					</strong>.</p>
			</div>
	</div>

	<!-- RMR Hakkında - Statik Son Sayfa (yenilendi) -->
	<div class="container page-break ">
		<div class="about-hero ">
			<% if (aboutRmr && aboutRmr.images && aboutRmr.images[0]) { %>
				<img src="<%= aboutRmr.images[0] %>" alt="RMR Hero" />
			<% } %>
			<div class="overlay"></div>
			<div class="text">
				<h2><%= (aboutRmr && aboutRmr.title) || 'RMR Enerji Hakkında' %></h2>
				<p>Güneş enerjisinde sürdürülebilir ve yenilikçi çözümler</p>
			</div>
		</div>

		<div class="about-section mustafaaa">
			<div class="about-summary">
				<h4>RMR Enerji Hakkında Kısa Özet</h4>
				<p class="about-text"><%= (aboutRmr && aboutRmr.description) || '' %></p>
			</div>
			<div class="about-card">
				<h4>RMR Enerji Şirket Bilgileri</h4>
				<div class="company-info">
					<div class="company-chip"><span class="label">Adres:</span><span class="value">Fevziçakmak, 10777 Sk. No:1AC, 42250 Karatay/Konya</span></div>
					<div class="company-chip"><span class="label">Uzmanlık:</span><span class="value">GES projeleri, EPC, bakım</span></div>
					<div class="company-chip"><span class="label">Hizmet Alanı:</span><span class="value">Türkiye genelinde</span></div>
					<div class="company-chip"><span class="label">VKN:</span><span class="value">00000000000</span></div>
					<div class="company-chip"><span class="label">Web:</span><span class="value">rmrenerji.com</span></div>
					<div class="company-chip"><span class="label">İletişim:</span><span class="value">rmrenerji@rmrenerji.com</span></div>
				</div>
			</div>
		</div>

		<div class="about-stats mustafaaa">
			<div class="stat"><div class="num">300+</div><div class="lbl">Tamamlanan Proje</div></div>
			<div class="stat"><div class="num">14+</div><div class="lbl">Yıl Deneyim</div></div>
			<div class="stat"><div class="num">%97</div><div class="lbl">Müşteri Memnuniyeti</div></div>
		</div>

		<div class="about-secondary">
			<h4 class="section-title ">RMR Enerji Olarak Yapılan Çalışmalar</h4>
			<div class="gallery">
				<% if (aboutRmr && aboutRmr.gallery && aboutRmr.gallery.length) { %>
					<% aboutRmr.gallery.slice(0,4).forEach(function(g){ %>
						<div class="tile">
							<img src="<%= g %>" alt="RMR Galeri" />
						</div>
					<% }); %>
				<% } %>
			</div>
		</div>

	</div>

</body>
</html>